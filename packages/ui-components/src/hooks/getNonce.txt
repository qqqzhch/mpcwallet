/* eslint @typescript-eslint/no-explicit-any: "off" */
// mpc account Nonce
import { chainTypeName } from '../constants/chainTypeName'
import { getsmpc } from '@monorepo/api/src/web3'
import { useAppStore } from '..'

export default async function useGetNonce(account: any, rpc: any, evmChainID: number, chainType: string) {
    const setCachecacheNonce = useAppStore(state=>state.setCacheNonce)
    const nonceLocal = useAppStore(state=>state.getCacheNonce(account))
    const isEvm = chainTypeName[chainType] == 0 ? true : false
    const nonceResult = await getsmpc(rpc).getNonce(account, evmChainID, isEvm, chainTypeName[chainType])
    let nonce;
    if (nonceLocal==undefined||nonceResult.Data >= nonceLocal) {
      nonce = nonceResult.Data + 1
      setCachecacheNonce(account,nonce)
    } else {
      nonce = nonceLocal
    }
    
  
    console.info('nonce', nonce)
    return nonce.toString()
  }